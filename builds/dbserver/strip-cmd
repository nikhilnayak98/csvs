#!/bin/bash
# 
# Author: Nikhil Ranjan Nayak
# Web: https://github.com/nikhilnayak98/csvs
# Email: Nikhil-Ranjan.Nayak@warwick.ac.uk
# Description: dbserver stripping

# with strip-image
../../scripts/strip-image  \
        -i u2185920/csvs2022-db_i \
        -p mariadb-server \
        -f /tmp \
        -f /var/lib/mysqld \
        -f /run/mysqld \
        -f /var \
        -d Dockerfile \
        -t u2185920/csvs2022-db_i:stripped

# with docker-slim
docker-slim build \
        --target u2185920/csvs2022-db_i \
        --include-path /mysql/mysql.conf.d/mysqld.cnf \
        --include-path /var/lib/mysqld/ \
        --include-path /run/mysqld/ \
        --include-path /etc/mysql/conf.d/ \
        --include-path /docker-entrypoint-initdb.d/ \
        --include-path /usr/bin/mysql \
        --include-path /usr/bin/mariadb-install-db \
        --include-path /usr/bin/my_print_defaults \
        --include-path /usr/bin/resolveip \
        --include-path /usr/share/mysql/ \
        --include-exe /bin/chown \
        --include-exe /bin/sh \
        --include-exe /bin/uname \
        --include-exe /bin/ls \
        --include-exe /bin/sed \
        --include-exe /bin/sleep \
        --include-exe /bin/mkdir \
        --include-exe /bin/grep \
        --include-shell=true \
        --http-probe=false \
        --tag u2185920/csvs2022-db_i:stripped